<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Like Hero To Zero - CO2-Emissionen</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            color: #333;
            background-color: #f4f4f4;
        }
        header {
            background-color: #4CAF50;
            color: white;
            padding: 1em 0;
            text-align: center;
            position: relative;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            margin: 0;
            font-size: 2em;
        }
        .data-display, .data-manipulation {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
        }
        .data-display h2, .data-manipulation h2 {
            margin-top: 0;
        }
        .data-display select, .data-display button, .data-manipulation input, .data-manipulation button {
            font-size: 1em;
            padding: 10px;
            margin-top: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .login {
            margin-top: 20px;
            padding: 15px;
            background-color: #e7f1e5;
            border-radius: 8px;
            text-align: center;
        }
        .login a {
            color: #4CAF50;
            text-decoration: none;
            font-weight: bold;
        }
        .login a:hover {
            text-decoration: underline;
        }
        footer {
            text-align: center;
            padding: 1em 0;
            background-color: #ddd;
            margin-top: 20px;
        }
        #co2-data {
            margin-top: 20px;
        }
        #user-info {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1em;
        }
        .data-manipulation {
            display: none; /* Anfangs versteckt */
        }
    </style>
</head>
<body>
    <header>
        <h1>Like Hero To Zero</h1>
        <p>Ihre Quelle für aktuelle CO2-Emissionen weltweit</p>
        <div id="user-info-container"></div>
    </header>
    
    <div class="container">
        <div class="data-display">
            <h2>Aktuelle CO2-Emissionen</h2>
            <p>Bitte wählen Sie Ihr Land und Jahr aus, um die aktuellsten verfügbaren Daten zu den CO2-Emissionen zu sehen.</p>
            <form id="country-form">
                <label for="country-select">Land auswählen:</label>
                <select id="country-select">
                    <option value="" disabled selected>Wählen Sie ein Land</option>
                    <option value="DE">Deutschland</option>
                    <option value="US">Vereinigte Staaten</option>
                    <option value="CN">China</option>
                    <option value="IN">Indien</option>
                    <!-- Weitere Länderoptionen können hier hinzugefügt werden -->
                </select>

                <label for="year-select">Jahr auswählen:</label>
                <select id="year-select">
                    <!-- Jahre werden dynamisch hinzugefügt -->
                </select>

                <button type="button" onclick="fetchCO2Data()">Daten anzeigen</button>
            </form>
            <div id="co2-data">
                <!-- Hier werden die CO2-Daten angezeigt -->
            </div>
        </div>

        <div class="data-manipulation">
            <h2>CO2-Daten bearbeiten oder hinzufügen</h2>
            <form id="data-manipulation-form">
                <label for="country-input">Land:</label>
                <input type="text" id="country-input" required>
                
                <label for="year-input">Jahr:</label>
                <input type="number" id="year-input" required>
                
                <label for="emission-input">CO2-Emissionen (kt):</label>
                <input type="number" id="emission-input" required>
                
                <button type="button" onclick="submitData()">Daten speichern</button>
            </form>
        </div>

        <div class="login">
            <h3>Für Wissenschaftler:innen</h3>
            <p>Wenn Sie registriert sind und neue Daten hinzufügen oder bestehende Daten korrigieren möchten, melden Sie sich bitte an:</p>
            <a href="backend-login.html">Zum Login-Bereich</a>
        </div>
    </div>

    <footer>
        <p>&copy; 2024 Like Hero To Zero - Alle Rechte vorbehalten</p>
    </footer>

    <script>
        // Funktion, um den eingeloggten Benutzer anzuzeigen
        function displayUser() {
            const userInfoContainer = document.getElementById('user-info-container');
            const user = localStorage.getItem('loggedInUser');

            if (user) {
                const userInfo = document.createElement('div');
                userInfo.id = 'user-info';
                userInfo.textContent = `Eingeloggt als: ${user}`;
                userInfoContainer.appendChild(userInfo);

                // Zeige die Datenmanipulation-Sektion nur, wenn ein Benutzer eingeloggt ist
                document.querySelector('.data-manipulation').style.display = 'block';
            }
        }

        // Funktion, um die Jahre für die Dropdown-Liste zu laden
        async function loadYears() {
            const yearSelect = document.getElementById('year-select');
            const currentYear = new Date().getFullYear();
            const startYear = 2014; // Startjahr für die CO2-Daten

            for (let year = currentYear; year >= startYear; year--) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                yearSelect.appendChild(option);
            }
        }

        // Funktion, um CO2-Daten abzurufen
        async function fetchCO2Data() {
            const countrySelect = document.getElementById('country-select');
            const yearSelect = document.getElementById('year-select');
            const selectedCountry = countrySelect.value;
            const selectedYear = yearSelect.value;
            const co2DataDiv = document.getElementById('co2-data');

            if (selectedCountry && selectedYear) {
                try {
                    const response = await fetch(`https://api.worldbank.org/v2/country/${selectedCountry}/indicator/EN.ATM.CO2E.KT?date=${selectedYear}&format=json`);
                    const data = await response.json();

                    if (data[1] && data[1].length > 0) {
                        const yearData = data[1][0];
                        const year = yearData.date;
                        const co2Emissions = yearData.value;
                        
                        co2DataDiv.innerHTML = `<p>CO2-Emissionen für ${selectedCountry} (${year}): ${co2Emissions ? co2Emissions.toFixed(2) : 'Daten nicht verfügbar'} kt</p>`;
                    } else {
                        co2DataDiv.innerHTML = '<p>Keine Daten verfügbar für das ausgewählte Jahr und Land.</p>';
                    }
                } catch (error) {
                    co2DataDiv.innerHTML = '<p>Fehler beim Abrufen der Daten. Bitte versuchen Sie es später erneut.</p>';
                }
            } else {
                co2DataDiv.innerHTML = '<p>Bitte wählen Sie ein Land und ein Jahr aus.</p>';
            }
        }

        // Funktion, um neue oder bearbeitete CO2-Daten zu speichern
        async function submitData() {
            const country = document.getElementById('country-input').value;
            const year = document.getElementById('year-input').value;
            const emissions = document.getElementById('emission-input').value;

            const data = {
                country: country,
                year: year,
                emissions: emissions
            };

            try {
                // POST-Request an den Server senden, um die Daten zu speichern
                const response = await fetch('/api/save-co2-data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (result.success) {
                    alert('Daten erfolgreich gespeichert.');
                } else {
                    alert('Fehler beim Speichern der Daten: ' + result.message);
                }
            } catch (error) {
                console.error('Fehler beim Speichern der Daten:', error);
                alert('Fehler beim Speichern der Daten. Bitte versuchen Sie es später erneut.');
            }
        }

        // Initialisierung der Seite
        window.onload = function() {
            loadYears();
            displayUser();
        };
    </script>
</body>
</html>
